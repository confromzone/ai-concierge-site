<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prisijungti · Nova Concierge</title>
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<meta name="theme-color" content="#0b1220">
<style>
:root{--bg:#0b1220;--card:#0f172a;--border:#1e293b;--text:#e5eef7;--muted:#9aa4b2;--brand:#6b5cff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
.box{display:grid;grid-template-columns:420px 1fr;gap:18px}
.card{background:#0f172a;border:1px solid var(--border);border-radius:16px;padding:18px}
h1{margin:8px 0 12px}label{font-size:14px;color:#c9d2e3}
input{width:100%;padding:12px;border:1px solid #203049;border-radius:10px;background:#0b1220;color:#eaf0ff}
.btn{padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:#101828;color:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(135deg,var(--brand),#7c3aed);border:0}
.small{color:#9aa9bf;font-size:13px}
canvas{width:100%;height:540px;background:#060913;border:1px solid #222;border-radius:12px}
.row{display:flex;gap:10px;align-items:center}
a{color:#cfe2ff}
@media(max-width:980px){.box{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
    <img src="/favicon.svg" width="28" height="28" alt=""><strong>Nova Concierge</strong>
  </div>

  <div class="box">
    <!-- auth -->
    <section class="card">
      <h1>Prisijungimas / Registracija</h1>
      <div class="small">Kol neprisijungiate, kiti puslapiai bus užrakinti.</div>
      <div style="height:10px"></div>

      <label>El. paštas</label>
      <input id="email" type="email" placeholder="you@email.com">
      <div style="height:10px"></div>
      <label>Slaptažodis</label>
      <input id="pass" type="password" placeholder="••••••••">
      <div style="height:12px"></div>

      <div class="row">
        <button class="btn primary" id="login">Prisijungti</button>
        <button class="btn" id="register">Registruotis</button>
      </div>

      <div style="height:12px"></div>
      <div class="small">
        Admin (lokali paskyra): <code>admin@novaconcierge.online</code> / <code>NovaAdmin#2025</code> (pakeiskite JS).
      </div>
      <div style="height:8px"></div>
      <div class="small">Užsiregistravus sukuriamas affiliate ID; po login būsite nukreipti į Workspace.</div>
    </section>

    <!-- game -->
    <section class="card">
      <h2 style="margin:0 0 8px">Mini žaidimas: „Įveik bosą — 20% nuolaida pirmam užsakymui“</h2>
      <div class="small">Akys seka pelę. Šaudai tik paspaudęs. Kas 10 pataikymų atsiranda širdelė (+1 gyvybė pelei). Boso ugninis kamuolys kartais atima visas tavo gyvybes.</div>
      <div style="height:8px"></div>
      <div class="row" style="gap:8px">
        <button class="btn" id="fs">Per visą ekraną</button>
        <div id="hud" class="small"></div>
      </div>
      <div style="height:8px"></div>
      <canvas id="game" width="900" height="540"></canvas>
    </section>
  </div>
</div>

<script>
// ======= AUTH (localStorage, tik greitam startui) =======
const ADMIN_EMAIL='admin@novaconcierge.online'; // <- PASIKEISK
const ADMIN_PASS='NovaAdmin#2025';              // <- PASIKEISK

function genAffId(email){ // trumpas hash
  let h=0; for (let c of email) h=(h*31+c.charCodeAt(0))>>>0;
  return ('00000000'+h.toString(16)).slice(-8);
}
function goNext(){
  const url=new URL(location.href);
  const next=url.searchParams.get('next')||'/affiliate.html';
  location.href=next;
}
document.getElementById('login').onclick=()=>{
  const email=document.getElementById('email').value.trim().toLowerCase();
  const pass=document.getElementById('pass').value;
  if(!email||!pass) return alert('Užpildykite laukus');
  // admin
  if(email===ADMIN_EMAIL && pass===ADMIN_PASS){
    localStorage.setItem('nc_user', JSON.stringify({email,role:'admin',affiliateId:'ADMIN'}));
    return goNext();
  }
  // partner
  const db=JSON.parse(localStorage.getItem('nc_users')||'[]');
  const u=db.find(x=>x.email===email && x.pass===pass);
  if(!u) return alert('Neteisingi duomenys');
  localStorage.setItem('nc_user', JSON.stringify({email,role:'partner',affiliateId:u.affiliateId}));
  goNext();
};
document.getElementById('register').onclick=()=>{
  const email=document.getElementById('email').value.trim().toLowerCase();
  const pass=document.getElementById('pass').value;
  if(!email||!pass) return alert('Užpildykite laukus');
  const db=JSON.parse(localStorage.getItem('nc_users')||'[]');
  if(db.some(x=>x.email===email)) return alert('Šis el. paštas jau registruotas');
  const affiliateId=genAffId(email);
  db.push({email,pass,affiliateId}); localStorage.setItem('nc_users', JSON.stringify(db));
  localStorage.setItem('nc_user', JSON.stringify({email,role:'partner',affiliateId}));
  // įsimenam ref sau – kad tavo linkai visur veiktų
  localStorage.setItem('nc_aff_ref', affiliateId);
  goNext();
};

// ======= GAME (boss) =======
const C=document.getElementById('game'), CT=C.getContext('2d');
const W=C.width, H=C.height;
let mouse={x:W/2,y:H/2,down:false}, t=0;

const player={x:W/2,y:H-70,hp:3,hits:0}; // gyvybės = 3, kas 10 hit +1
const boss={x:W/2,y:110,hp:1000,dir:1,eye:0};
const bullets=[], fireballs=[], hearts=[];

C.addEventListener('pointermove',e=>{const r=C.getBoundingClientRect();mouse.x=e.clientX-r.left;mouse.y=e.clientY-r.top;});
C.addEventListener('pointerdown',()=>{mouse.down=true; shoot()});
C.addEventListener('pointerup',()=>{mouse.down=false;});
document.getElementById('fs').onclick=()=>{ if(C.requestFullscreen) C.requestFullscreen(); };

function shoot(){
  bullets.push({x:mouse.x,y:mouse.y-20,v:-8});
}
function spawnHeart(){
  hearts.push({x:Math.random()*(W-60)+30,y:Math.random()*(H-220)+160,ttl:900});
}
function spawnFireball(){
  fireballs.push({x:boss.x,y:boss.y+30,vx:(Math.random()-.5)*2,vy:2.3,r:10});
}

function step(){
  t++; CT.clearRect(0,0,W,H);

  // boss move
  boss.x+=boss.dir*1.2; if(boss.x<80||boss.x>W-80) boss.dir*=-1;
  // eyes follow
  const ex=boss.x, ey=boss.y, ang=Math.atan2(mouse.y-ey, mouse.x-ex);
  const eyeX=Math.cos(ang)*10, eyeY=Math.sin(ang)*8;

  // draw boss
  CT.fillStyle='#3a3f6b'; CT.beginPath(); CT.arc(boss.x,boss.y,60,0,Math.PI*2); CT.fill();
  CT.fillStyle='#ffffff'; CT.beginPath(); CT.arc(boss.x-18,boss.y-8,14,0,Math.PI*2); CT.arc(boss.x+18,boss.y-8,14,0,Math.PI*2); CT.fill();
  CT.fillStyle='#111'; CT.beginPath(); CT.arc(boss.x-18+eyeX*0.5,boss.y-8+eyeY*0.5,6,0,Math.PI*2); CT.arc(boss.x+18+eyeX*0.5,boss.y-8+eyeY*0.5,6,0,Math.PI*2); CT.fill();
  // hp bar
  CT.fillStyle='#555'; CT.fillRect(20,20,W-40,10);
  CT.fillStyle='#7c3aed'; CT.fillRect(20,20,(W-40)*(Math.max(boss.hp,0)/1000),10);

  // player
  player.x+= (mouse.x-player.x)*0.25; player.y=H-70;
  CT.fillStyle='#18c7f5'; CT.beginPath(); CT.arc(player.x,player.y,16,0,Math.PI*2); CT.fill();
  // barrel
  if(mouse.down && t%8===0) shoot();

  // bullets
  CT.fillStyle='#9ae6b4';
  for(let i=bullets.length;i--;){
    const b=bullets[i]; b.y+=b.v;
    CT.fillRect(b.x-2,b.y,4,10);
    // hit boss?
    const dx=b.x-boss.x, dy=b.y-boss.y; if(dx*dx+dy*dy<60*60){ bullets.splice(i,1); boss.hp-=0.5; player.hits++; if(player.hits%10===0) spawnHeart(); continue; }
    if(b.y<-20) bullets.splice(i,1);
  }

  // hearts
  CT.fillStyle='#f87171';
  hearts.forEach(h=>{ CT.beginPath(); CT.arc(h.x,h.y,8,0,Math.PI*2); CT.fill(); h.ttl--; });
  for(let i=hearts.length;i--;){
    const h=hearts[i]; if((h.x-player.x)**2 + (h.y-player.y)**2 < 20*20){ player.hp=Math.min(player.hp+1,10); hearts.splice(i,1); }
    else if(h.ttl<=0) hearts.splice(i,1);
  }

  // fireballs (sometimes)
  if(t%120===0 && Math.random()<.6) spawnFireball();
  CT.fillStyle='#ff914d';
  for(let i=fireballs.length;i--;){
    const f=fireballs[i]; f.x+=f.vx; f.y+=f.vy; f.r+=0.08;
    CT.beginPath(); CT.arc(f.x,f.y,f.r,0,Math.PI*2); CT.fill();
    // hit player? -> all HP to 0
    const dx=f.x-player.x, dy=f.y-player.y; if(dx*dx+dy*dy < (f.r+16)**2){ player.hp=0; fireballs.splice(i,1); }
    if(f.y>H+30) fireballs.splice(i,1);
  }

  // HUD
  const hud=`Boso HP: ${Math.max(0,Math.round(boss.hp))} · Tavo HP: ${player.hp} · Pataikymai: ${player.hits}`;
  document.getElementById('hud').textContent=hud;

  if(player.hp<=0){ over('Pralaimėjai! Pabandyk dar kartą.'); return; }
  if(boss.hp<=0){ over('Valio! Gavai 20% nuolaidą pirmajam užsakymui.'); return; }
  requestAnimationFrame(step);
}
function over(msg){
  CT.fillStyle='rgba(0,0,0,.65)'; CT.fillRect(0,0,W,H);
  CT.fillStyle='#fff'; CT.font='20px Inter'; CT.fillText(msg, 28, H/2);
}
step();
</script>
</body>
</html>
