<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prisijungti · Nova Concierge</title>
<link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta name="theme-color" content="#0b1220">
<style>
:root{--bg:#0b1220;--card:#0f172a;--border:#1e293b;--text:#e5eef7;--muted:#9aa4b2;--brand:#6b5cff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
.box{display:grid;grid-template-columns:420px 1fr;gap:18px}
.card{background:#0f172a;border:1px solid var(--border);border-radius:16px;padding:18px}
h1{margin:8px 0 12px}label{font-size:14px;color:#c9d2e3}
input{width:100%;padding:12px;border:1px solid #203049;border-radius:10px;background:#0b1220;color:#eaf0ff}
.btn{padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:#101828;color:#fff;cursor:pointer}
.btn.primary{background:linear-gradient(135deg,var(--brand),#7c3aed);border:0}
.small{color:#9aa9bf;font-size:13px}
canvas{width:100%;height:540px;background:#060913;border:1px solid #222;border-radius:12px}
.row{display:flex;gap:10px;align-items:center}
a{color:#cfe2ff}
@media(max-width:980px){.box{grid-template-columns:1fr}}
/* account menu mini CSS */
.account{position:relative}
.avatar{width:36px;height:36px;border-radius:999px;background:#1f2a44;border:1px solid #2b3b5a;color:#dbe7ff;font-weight:700;display:grid;place-items:center;cursor:pointer}
.account .menu{position:absolute;right:0;top:44px;background:#0f172a;border:1px solid #1e293b;border-radius:12px;min-width:220px;display:none;z-index:50}
.account .menu.open{display:block}
.account .menu .email{padding:10px 12px;color:#aab5c7;border-bottom:1px solid #1e293b}
.account .menu a,.account .menu button{display:block;width:100%;text-align:left;background:none;border:0;color:#e7eefb;padding:10px 12px;cursor:pointer}
.account .menu a:hover,.account .menu button:hover{background:#0b1220}
</style>
<script src="/nc-app.js"></script>
</head>
<body>
<div class="wrap">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
    <img src="/favicon.svg" width="28" height="28" alt=""><strong>Nova Concierge</strong>
    <div style="margin-left:auto" id="header-actions"></div>
  </div>

  <div class="box">
    <section class="card">
      <h1>Prisijungimas / Registracija</h1>
      <div class="small">Kol neprisijungiate, saugomi puslapiai bus užrakinti.</div>
      <div style="height:10px"></div>
      <label>El. paštas</label>
      <input id="email" type="email" placeholder="you@email.com">
      <div style="height:10px"></div>
      <label>Slaptažodis</label>
      <input id="pass" type="password" placeholder="••••••••">
      <div style="height:12px"></div>
      <div class="row">
        <button class="btn primary" id="login">Prisijungti</button>
        <button class="btn" id="register">Registruotis</button>
      </div>
      <div style="height:12px"></div>
      <div class="small">Admin (lokali paskyra): <code>admin@novaconcierge.online</code> / <code>NovaAdmin#2025</code>.</div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px">Mini žaidimas: „Įveik bosą — 20% nuolaida“</h2>
      <div class="small">Akys seka pelę. Šaudai tik paspaudęs. Kas 10 pataikymų – širdelė (+1 HP). Boso ugninis kamuolys gali nuimti visas tavo gyvybes.</div>
      <div style="height:8px"></div>
      <div class="row" style="gap:8px">
        <button class="btn" id="fs">Per visą ekraną</button>
        <div id="hud" class="small"></div>
      </div>
      <div style="height:8px"></div>
      <canvas id="game" width="900" height="540"></canvas>
    </section>
  </div>
</div>

<script>
// Header actions (rodome jei jau login)
NC.ncRenderHeaderActions();

function goNext(){ const url=new URL(location.href); const next=url.searchParams.get('next')||'/affiliate.html'; location.href=next; }
document.getElementById('login').onclick=()=>{const e=email.value.trim(), p=pass.value; if(!e||!p) return alert('Užpildykite laukus'); if(NC.ncDoLogin(e,p)) goNext(); else alert('Neteisingi duomenys');};
document.getElementById('register').onclick=()=>{const e=email.value.trim(), p=pass.value; if(!e||!p) return alert('Užpildykite laukus'); const r=NC.ncDoRegister(e,p); if(r.ok) goNext(); else alert(r.msg||'Nepavyko')};

// ======= GAME =======
const C=document.getElementById('game'), CT=C.getContext('2d'); const W=C.width,H=C.height;
let mouse={x:W/2,y:H/2,down:false}, t=0;
const player={x:W/2,y:H-70,hp:3,hits:0}; const boss={x:W/2,y:110,hp:1000,dir:1};
const bullets=[], fireballs=[], hearts=[];
C.addEventListener('pointermove',e=>{const r=C.getBoundingClientRect();mouse.x=e.clientX-r.left;mouse.y=e.clientY-r.top;});
C.addEventListener('pointerdown',()=>{mouse.down=true; shoot();}); C.addEventListener('pointerup',()=>mouse.down=false);
document.getElementById('fs').onclick=()=>{ if(C.requestFullscreen) C.requestFullscreen(); };

function shoot(){ bullets.push({x:mouse.x,y:mouse.y-20,v:-8}); }
function spawnHeart(){ hearts.push({x:Math.random()*(W-60)+30,y:Math.random()*(H-220)+160,ttl:900}); }
function spawnFireball(){ fireballs.push({x:boss.x,y:boss.y+30,vx:(Math.random()-.5)*2,vy:2.3,r:10}); }

function step(){
  t++; CT.clearRect(0,0,W,H);
  boss.x+=boss.dir*1.2; if(boss.x<80||boss.x>W-80) boss.dir*=-1;

  // eyes follow
  const ang=Math.atan2(mouse.y-boss.y, mouse.x-boss.x), eyeX=Math.cos(ang)*10, eyeY=Math.sin(ang)*8;
  CT.fillStyle='#3a3f6b'; CT.beginPath(); CT.arc(boss.x,boss.y,60,0,Math.PI*2); CT.fill();
  CT.fillStyle='#fff'; CT.beginPath(); CT.arc(boss.x-18,boss.y-8,14,0,Math.PI*2); CT.arc(boss.x+18,boss.y-8,14,0,Math.PI*2); CT.fill();
  CT.fillStyle='#111'; CT.beginPath(); CT.arc(boss.x-18+eyeX*0.5,boss.y-8+eyeY*0.5,6,0,Math.PI*2); CT.arc(boss.x+18+eyeX*0.5,boss.y-8+eyeY*0.5,6,0,Math.PI*2); CT.fill();
  CT.fillStyle='#555'; CT.fillRect(20,20,W-40,10); CT.fillStyle='#7c3aed'; CT.fillRect(20,20,(W-40)*(Math.max(boss.hp,0)/1000),10);

  player.x+=(mouse.x-player.x)*0.25; player.y=H-70;
  CT.fillStyle='#18c7f5'; CT.beginPath(); CT.arc(player.x,player.y,16,0,Math.PI*2); CT.fill();
  if(mouse.down && t%8===0) shoot();

  CT.fillStyle='#9ae6b4';
  for(let i=bullets.length;i--;){ const b=bullets[i]; b.y+=b.v; CT.fillRect(b.x-2,b.y,4,10);
    const dx=b.x-boss.x, dy=b.y-boss.y; if(dx*dx+dy*dy<60*60){ bullets.splice(i,1); boss.hp-=0.5; player.hits++; if(player.hits%10===0) spawnHeart(); continue; }
    if(b.y<-20) bullets.splice(i,1);
  }
  CT.fillStyle='#f87171';
  hearts.forEach(h=>{ CT.beginPath(); CT.arc(h.x,h.y,8,0,Math.PI*2); CT.fill(); h.ttl--; });
  for(let i=hearts.length;i--;){ const h=hearts[i]; if((h.x-player.x)**2+(h.y-player.y)**2<20*20){ player.hp=Math.min(player.hp+1,10); hearts.splice(i,1);} else if(h.ttl<=0) hearts.splice(i,1); }

  if(t%120===0 && Math.random()<.6) spawnFireball();
  CT.fillStyle='#ff914d';
  for(let i=fireballs.length;i--;){ const f=fireballs[i]; f.x+=f.vx; f.y+=f.vy; f.r+=0.08;
    CT.beginPath(); CT.arc(f.x,f.y,f.r,0,Math.PI*2); CT.fill();
    const dx=f.x-player.x, dy=f.y-player.y; if(dx*dx+dy*dy<(f.r+16)**2){ player.hp=0; fireballs.splice(i,1); }
    if(f.y>H+30) fireballs.splice(i,1);
  }
  document.getElementById('hud').textContent=`Boso HP: ${Math.max(0,Math.round(boss.hp))} · Tavo HP: ${player.hp} · Pataikymai: ${player.hits}`;
  if(player.hp<=0){ over('Pralaimėjai! Pabandyk dar kartą.'); return; }
  if(boss.hp<=0){ over('Valio! 20% nuolaida pirmajam užsakymui.'); return; }
  requestAnimationFrame(step);
}
function over(msg){ CT.fillStyle='rgba(0,0,0,.65)'; CT.fillRect(0,0,W,H); CT.fillStyle='#fff'; CT.font='20px Inter'; CT.fillText(msg,28,H/2); }
step();
</script>
</body>
</html>
